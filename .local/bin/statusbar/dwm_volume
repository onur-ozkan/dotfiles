#!/usr/bin/env bash

# Read the current sink volume via PipeWire's wpctl CLI
if ! volume_output=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ 2>/dev/null); then
	volume_output=""
fi

vol=$(awk '/Volume:/ { print $2; exit }' <<< "$volume_output")
vol=${vol:-0}
vol=$(LC_ALL=C awk -v value="$vol" 'BEGIN { printf "%d", (value * 100) + 0.5 }')

if grep -qiE 'Mute:\s*(1|yes|true)|\[MUTED\]' <<< "$volume_output"; then
	vol_icon=" "
elif [ "$vol" -eq 0 ]; then
	vol_icon=" "
elif [ "$vol" -lt 50 ]; then
	vol_icon=" "
else
	vol_icon=" "
fi

printf "%s^c#f7ca88^%s%%^d^" "$vol_icon" "$vol"
